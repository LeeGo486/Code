@{
    ViewBag.Title = "点亮星星";
    Layout = "~/Views/Shared/_WeiXinBaseLayout.cshtml";
    string rat1 = "";
}

@section script{
    <link rel="stylesheet" href="~/Areas/Game/Resources/css/HZYTourismActivities.css?v3" />
    <script src="~/Scripts/Rating/bootstrap-rating-input.min.js"></script>
    <script type="text/javascript" src="~/Scripts/jweixin-1.0.0.js"></script>
    <script type="text/javascript" src="~/Scripts/fullPage/jquery.fullPage.js"></script>
    <script>
        $(function () {

            $.post("/Game/HZYTourismActivities/GetAppId?sid=" + Url.get("sid") + "&oid=" + Url.get("oid"), function (rst) {
                if (rst.result == 0) {
                    appId = rst.msg;
                    //获取ticket
                    $.post("/Game/HZYTourismActivities/GetTicket?sid=" + Url.get("sid") + "&oid=" + Url.get("oid"), function (rst) {
                        if (rst.result == 0) {
                            ticket = rst.msg;
                            timestamp = parseInt(new Date().getTime() / 1000) + '';
                            nonceStr = Math.random().toString(36).substr(2, 15);

                            //获取signature
                            $.post("/Game/HZYTourismActivities/GetSignature?sid=" + Url.get("sid") + "&oid=" + Url.get("oid") + "&ticket=" + ticket + "&nonceStr=" + nonceStr + "&timestamp=" + timestamp + "&url=" + window.location.href.replace(/&/g, '%26'), function (rst) {
                                if (rst.result == 0) {
                                    signature = rst.msg;
                                    wx.config({
                                        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                                        appId: appId, // 必填，公众号的唯一标识
                                        timestamp: timestamp, // 必填，生成签名的时间戳
                                        nonceStr: nonceStr, // 必填，生成签名的随机串
                                        signature: signature,// 必填，签名，见附录1
                                        jsApiList: [
                                            'onMenuShareTimeline',
                                            'onMenuShareAppMessage'
                                        ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
                                    });
                                } else {
                                    //alert("获取signature失败")
                                }
                            });
                        } else {
                            //alert("获取GetTicket失败")
                        }
                    });
                } else {
                    //alert("获取appid失败")
                }
            });

            $(".icon-star-empty").attr("style", "color:#ffeb05");
            $("#bg img").load(function () {
                var bgHeight = $("#bg img").height();
                var bgWidth = $("#bg img").width();
                $("#Photo").css("top", bgHeight * 0);
            });

        });


        wx.ready(function () {
            var url = "http://it.hwafashion.com/Game/HZYTourismActivities/index?sid=" + Url.get("sid") + "&oid=" + Url.get("oid") + "&SerialNumber=" + Url.get("SerialNumber");
            var imgUrl = 'http://it.hwafashion.com/Areas/Game/Resources/images/HZYTourismActivities/1.png';
            wx.onMenuShareTimeline({
                title: '点星星赢旅费啦！', // 分享标题
                link: url,// 分享链接
                imgUrl: imgUrl, // 分享图标
                success: function () {
                    // 用户确认分享后执行的回调函数
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });

            wx.onMenuShareAppMessage({
                title: '点星星赢旅费啦！', // 分享标题
                desc: '世界那么大，终于可以出去玩了，竟然还有旅费拿……', // 分享描述
                link: url, // 分享链接
                imgUrl: imgUrl, // 分享图标
                success: function () {
                },
                cancel: function () {
                }
            });
        });

        wx.error(function (res) {
            //alert(res);
        });



        function submittp() {

            Msg.show("活动已经结束！", 1);
            return;
            if (isNaN(parseInt($("#txtRat1").val()) + 1)) {
                Msg.show("请先点击星星评价！", 1);
                return;
            }

            //构造提交json的格式
            var paramData = {
                linkedTimes: parseInt($("#txtRat1").val()) + 1,
                Num: Url.get("SerialNumber")
            };
            Msg.show("提交中...", 3);
            $.post("/Game/HZYTourismActivities/Submittp?sid=" + Url.get("sid") + "&oid=" + Url.get("oid"), paramData, function (rst) {
                Msg.hide();
                Msg.show(rst.msg, rst.result);
                if (rst.msg == "对不起你未关注无法投票") {
                    setTimeout(function () {
                        window.location.href = "http://mp.weixin.qq.com/s?__biz=MzIwODAxNzA1OQ==&mid=209452489&idx=1&sn=d725ac690920900789eb1f5f713290f7#rd";
                    }, 2000)
                }
                //if (rst.result == 0) {

                //    //var share = "<div class='share'><img src=\"/Areas/Game/Resources/images/HZYTourismActivities/share2.png\"</div>";
                //    //var share1 = "<div class=\"share1\"><img src=\"/Areas/Game/Resources/images/HZYTourismActivities/sharebg.png\"</div>";

                //    //$(".mainArea1").append(share)
                //    //$(".mainArea1").append(share1)

                //    //var bgHeight = document.body.clientHeight;
                //    //$(".share1").css("top", 0);
                //    //$(".mainArea1").fullpage({})
                //}
                //else {
                //    Msg.show(rst.msg, rst.result);
                //}
            });
        }
        function iwant() {
            window.location.href = "/Game/HZYTourismActivities/iwant?sid=" + Url.get("sid") + "&oid=" + Url.get("oid");
        }

        function goIndex() {
            window.location.href = "/Game/HZYTourismActivities/Index?sid=" + Url.get("sid") + "&oid=" + Url.get("oid");
        }
        //function share() {

        //    var share = "<div class='share'><img src=\"/Areas/Game/Resources/images/HZYTourismActivities/share2.png\"</div>";
        //    var share1 = "<div class=\"share1\"><img src=\"/Areas/Game/Resources/images/HZYTourismActivities/sharebg.png\"</div>";

        //    $(".mainArea1").append(share)
        //    $(".mainArea1").append(share1)

        //    var bgHeight = document.body.clientHeight;
        //    $(".share1").css("height", bgHeight);
        //    $(".share1").css("top", 0);
        //}
    </script>
    <style type="text/css">
        .share {
            position: absolute;
            top: 0px;
            left: 0px;
            z-index: 999999999;
        }

            .share img {
                width: 100%;
                height: 200%;
            }

        .share1 {
            position: absolute;
            z-index: 999999999;
        }

            .share1 img {
                width: 100%;
            }
    </style>
}
<body style="background-color: #fffeba" class="mainArea1">
    <div id="bg">
        <img src="~/Areas/Game/Resources/images/HZYTourismActivities/toupiao.jpg" alt="head" style="width: 100%" />
    </div>
    <div id="Photo" style="position: absolute; z-index: 20; background: #fffeba">

        <div style="margin: 10px 10px 0px 10px; background-color: #ededec;">
            <div style="padding: 0px 0px 12px 0px">
                <img src="/Content/Uploads/HZYTourismActivities/Thumbnail/@ViewBag.Img" alt="head" style="width: 100%"  />
            </div>
            <table style="margin-left: 15px; margin-bottom: 5px; font-size: 20px; color: #8a3522; vertical-align: bottom">
                <tr>
                    <td>
                        <img src="~/Areas/Game/Resources/images/HZYTourismActivities/No.png" alt="head" style="width: 10%" />@ViewBag.SerialNumber
                        <span>&nbsp; &nbsp;
                    <img src="~/Areas/Game/Resources/images/HZYTourismActivities/Loc.png" alt="head" style="width: 10%" />@ViewBag.Address</span><br />
                        <span style="font-size: 14px;">@ViewBag.Introduction</span>
                    </td>
                </tr>
            </table>
        </div>

        <div>
            <table style="margin: 40px 0px 0px 0px">
                <tr>
                    <td style="text-align: right">
                        <img src="~/Areas/Game/Resources/images/HZYTourismActivities/luosi.png" alt="head" style="width: 50%" /></td>
                    <td style="width: 50%; text-align: center">
                        <input type="number" id="txtRat1" class="rating" data-max="4" /></td>
                    <td style="text-align: left">
                        <img src="~/Areas/Game/Resources/images/HZYTourismActivities/pangxie2.png" alt="head" style="width: 50%" /></td>
                </tr>
                <tr>
                    <td colspan="3" style="text-align: center">
                        <img onclick="submittp()" src="~/Areas/Game/Resources/images/HZYTourismActivities/ButtonMI.png" alt="head" style="width: 100%" /></td>
                </tr>
                <tr>
                    <td>
                        <br />
                    </td>
                </tr>
                <tr>
                    <td colspan="3" style="text-align: center">
                        <img onclick="iwant()" src="~/Areas/Game/Resources/images/HZYTourismActivities/iwantshare.png" alt="head" style="width: 100%" />
                </tr>
                <tr>
                    <td colspan="3" style="text-align: center">
                        <img onclick="iwant()" src="~/Areas/Game/Resources/images/HZYTourismActivities/goindex.png" alt="head" style="width: 100%" />
                </tr>
            </table>
        </div>

        <div id="jieshao" style="font-family: 'Microsoft YaHei'; height: 250px; background: url(/Areas/Game/Resources/images/HZYTourismActivities/toupiao2.png) bottom center  repeat-x; background-size: 100%">
            <table style="color: #fff; width: 100%; text-align: center; bottom: 10px; position: absolute">
                <tr>
                    <td>
                        <img src="~/Areas/Game/Resources/images/HZYTourismActivities/zi1.png" alt="head" width='100' />&nbsp;&nbsp;@ViewBag.ImgRecordCount
                        <img src="~/Areas/Game/Resources/images/HZYTourismActivities/zi2.png" alt="head" width='20' />
                    </td>
                </tr>
                <tr>
                    <td>
                        <img src="~/Areas/Game/Resources/images/HZYTourismActivities/zi4.png" alt="head" width='100' />&nbsp;&nbsp;@ViewBag.Num
                        <img src="~/Areas/Game/Resources/images/HZYTourismActivities/zi4.png" alt="head" width='20' />
                    </td>
                </tr>
            </table>
        </div>
    </div>
</body>




@{
    ViewBag.Title = "我正在参加2015EP雅莹“莹彩风尚”少儿模特大赛，请为我投票！";
    Layout = "~/Areas/Game/Views/Shared/_BaseLayout.cshtml";
}

@section script{
    <link rel="stylesheet" href="~/Areas/Game/Resources/css/LittleModel.css" />

     <script>
         var appId, ticket, timestamp, nonceStr, signature;

         $(function () {
             //获取appid
             $.post("/Game/LittleModel/GetAppId?sid=" + Url.get("sid") + "&oid=" + Url.get("wxid"), function (rst) {
                 if (rst.result == 0) {
                     appId = rst.msg;
                     //获取ticket
                     $.post("/Game/LittleModel/GetTicket?sid=" + Url.get("sid") + "&oid=" + Url.get("wxid"), function (rst) {
                         if (rst.result == 0) {
                             ticket = rst.msg;
                             timestamp = parseInt(new Date().getTime() / 1000) + '';
                             nonceStr = Math.random().toString(36).substr(2, 15);

                             //获取signature
                             $.post("/Game/LittleModel/GetSignature?sid=" + Url.get("sid") + "&oid=" + Url.get("wxid") + "&ticket=" + ticket + "&nonceStr=" + nonceStr + "&timestamp=" + timestamp + "&url=" + window.location.href.replace(/&/g, '%26'), function (rst) {
                                 if (rst.result == 0) {
                                     signature = rst.msg;
                                     wx.config({
                                         debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                                         appId: appId, // 必填，公众号的唯一标识
                                         timestamp: timestamp, // 必填，生成签名的时间戳
                                         nonceStr: nonceStr, // 必填，生成签名的随机串
                                         signature: signature,// 必填，签名，见附录1
                                         jsApiList: [
                                             'onMenuShareTimeline',
                                             'onMenuShareAppMessage'
                                         ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
                                     });
                                 } else {
                                     //alert("获取signature失败")
                                 }
                             });
                         } else {
                             //alert("获取GetTicket失败")
                         }
                     });
                 } else {
                     //alert("获取appid失败")
                 }
             });

             var Ticket = '@ViewBag.Ticketid';
            if (Ticket == "") {
                $("#Winning").hide();
            } else {
                $("#Winning").show();
            }
        });

        wx.ready(function () {

            var url = "http://it.hwafashion.com/Game/LittleModel/Index?sid=" + Url.get("sid") + "&wxid=" + Url.get("wxid");
            var imgUrl = 'http://it.hwafashion.com/Game/Resources/images/LittleModel/share.jpg';
            wx.onMenuShareTimeline({
                title: '2015EP雅莹“莹彩风尚”少儿模特大赛', // 分享标题
                link: url,// 分享链接
                imgUrl: imgUrl, // 分享图标
                success: function () {
                    // 用户确认分享后执行的回调函数
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });

            wx.onMenuShareAppMessage({
                title: '2015EP雅莹“莹彩风尚”少儿模特大赛', // 分享标题
                desc: '少儿模特大赛', // 分享描述
                link: url, // 分享链接
                imgUrl: imgUrl, // 分享图标
                success: function () {
                },
                cancel: function () {
                }
            });
        });

        wx.error(function (res) {
            //alert(res);
        });
    </script>



    <script>
    function goIndex(sid, oid) {
        window.open("/Game/LittleModel/Index?sid=" + sid + "&wxid=" + oid);
           
        //window.location.href("/Game/LittleModel/Index?sid=" + sid + "&wxid=" + oid);
    };
    function goAD() {
        window.open("http://mp.weixin.qq.com/s?__biz=MzA5MTk5ODgzOA==&mid=206553735&idx=2&sn=e03062011fa2e186c2f9a0da2eceef45#rd");
    };
    </script>
    }

<div class="container">

    <img class="characters" src="~/Areas/Game/Resources/images/LittleModel/characters.png" alt="characters"/>

    
    <!--characters-->
    <div class="row" style="margin-top:10px;">
        <div class="col-xs-12">
            <p style="font-size:1.4em;">@ViewBag.VoteResult</p>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <button type="button" class="btn btn-link resultButton" onclick="goIndex('@ViewBag.sid','@ViewBag.oid')">@ViewBag.index</button>
        </div>
    </div>
    <div class="row" style="margin-top:10px;margin-bottom:10px;">
        <div class="col-xs-12">
            <button type="button" class="btn btn-link resultButton" onclick="goAD()">点击还有更多精彩</button>
        </div>
    </div>
</div>

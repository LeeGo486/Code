@{
    ViewBag.Title = "用户注册";
    Layout = "~/Views/Shared/_WeiXinLayout.cshtml";
}
@section script{
    <link href="~/Areas/S3/Resources/Mobile.css" rel="stylesheet" />
    <script type="text/javascript">
        function updateTimeLabel(time) {
            var btn = $("#getAuthCode");
            btn.fadeIn(500);
            btn[0].innerHTML = (time <= 0 ? "获取验证码" : ((time) + "秒后重试"));
            var hander = setInterval(function () {
                if (time <= 0) {
                    clearInterval(hander);
                    btn[0].innerHTML = ("获取验证码");
                    btn.attr("disabled", false);
                }
                else {
                    btn[0].innerHTML = ((time--) + "秒后重试"); btn
                    btn.attr("disabled", true);
                }
            }, 1000);
        }

        $(function () {
            /***********发送验证短信************/
            $("#getAuthCode").click(function () {
                var strMobileNumber = $("#txtPhone").val();
                if (!/^1[34587]\d{9}$/.test(strMobileNumber)) {
                    $("#txtPhone").focus();
                    Msg.show('手机号码无效', 1);
                    return;
                }
                $("#txtAuthenticode").focus();
                //按钮倒计时
                updateTimeLabel(60);
                Msg.show("短信发送中...", 3);
                var url = "/S3/User/SendSms?sid=" + Url.get("sid") + "&oid=" + Url.get("oid") + "&tel=" + $("#txtPhone").val();
                $.post(url, function (rst) {
                    Msg.hide();
                    Msg.show(rst.msg, rst.result);
                });
            });


            //申请注册
            $("#btnSubmit").click(function () {
                var LoginUser = $("#txtPhone").val();
                if (!/^1[34587]\d{9}$/.test(LoginUser)) {
                    $("#txtPhone").focus();
                    Msg.show('手机号码无效', 1);
                    return;
                }
                var AuthCode = $("#txtAuthenticode").val();
                if ($.trim(AuthCode).length <= 0) {
                    $("#txtAuthenticode").focus();
                    Msg.show('请输入短信验证码', 1);
                    return;
                }
                var PassWord = $("#txtPwd").val();
                if ((PassWord.length<6) || !/^(?=.*\d.*)(?=.*[a-zA-Z_].*).{5,15}$/.test(PassWord)) {
                    $("#txtPwd").focus();
                    Msg.show('密码强度不够', 1);
                    return;
                }
                var cfPassWord = $("#txtConfirmPwd").val();
                if (cfPassWord != PassWord) {
                    $("#txtConfirmPwd").focus();
                    Msg.show('两次密码不一致', 1);
                    return;
                }
                var postData = {
                    tel: LoginUser,
                    pwd: PassWord,
                    code: AuthCode
                };
                Msg.show("请稍候...", 3);
                var url = "/S3/User/RegistMember?sid=" + Url.get("sid") + "&oid=" + Url.get("oid");
                $.post(url, postData,function (rst) {
                    Msg.hide();
                    Msg.show(rst.msg, rst.result);
                    if (rst.result == 0) {
                        if (Url.get("ReturnUrl") != null) {
                            window.location.href = Url.get("ReturnUrl");
                        } else {
                            window.location.href = "/S3/User/EhrDrpBinding?sid=" + Url.get("sid") + "&oid=" + Url.get("oid");
                        }
                    }
                });
            });

            $("#getAuthCode").attr("disabled", false);
        });
    </script>
}

<div class="dataDetail">
    <h4><span><i class="glyphicon glyphicon-user"></i>&nbsp;&nbsp;3S 账号注册</span></h4>
    <div class="input-group">
        <span class="input-group-addon">手机号码</span>
        <input id="txtPhone" name="txtPhone" type="number" class="form-control" maxlength="11" placeholder="请填写手机号码">
    </div>
    <br />
    <div class="input-group">
        <span class="input-group-addon">验&ensp;证&ensp;码</span>
        <input id="txtAuthenticode" name="txtAuthenticode" type="number" class="form-control" maxlength="4" placeholder="请查收短信验证码">
        <span class="input-group-btn">
            <button id="getAuthCode" class="btn btn-default" type="button">获取验证码</button>
        </span>
    </div>
    <br />
    <div class="input-group">
        <span class="input-group-addon">密&emsp;&emsp;码</span>
        <input id="txtPwd" name="txtPwd" type="password" class="form-control" maxlength="16" placeholder="6~16个字符，包含字母和数字">
    </div>
    <br />
    <div class="input-group ">
        <span class="input-group-addon">确认密码</span>
        <input id="txtConfirmPwd" name="txtConfirmPwd" type="password" class="form-control" maxlength="16" placeholder="请再次填写密码">
    </div>
    <input id="btnSubmit" type="button" value="申请注册" class="btn btn-success" style="width: 100%; margin-top: 30px;" />
</div>

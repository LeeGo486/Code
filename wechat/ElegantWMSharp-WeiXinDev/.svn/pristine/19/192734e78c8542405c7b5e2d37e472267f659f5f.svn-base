@{
    ViewBag.Title = "商品详细";
    Layout = "~/Views/Shared/_DLWXSiteLayout.cshtml";
}

@section script{
    <link href="~/Areas/DLWXSite/Resources/Mobile.css?v3" rel="stylesheet" />
    <link href="~/Scripts/fullPage/jquery.fullPage.css" rel="stylesheet" />
    <script src="~/Scripts/fullPage/jquery.fullPage.js"></script>
    <script src="~/Scripts/fullPage/fullPage.min.js"></script>

    <script>
        $(function () {
            $('#fullpage').fullpage({
                'verticalCentered': false,
                'navigation': true,
                'navigationPosition': 'left',
                'continuousVertical': true
            })

            $('#SKUDetail').hide();
            $('#MaterialDeatil').hide();

            $("#CancelSKUDetail").click(function () {
                $('#SKUDetail').hide();
            });

            $("#addTry").click(function () {
                $('#SKUDetail').show();
            });

            $("#Cancel").click(function () {
                $('#MaterialDeatil').hide();
            });

            //我要预购
            $("#order").click(function () {
                if (!$("#color button").hasClass("active")) {
                    Msg.show("请选择颜色", 1);
                    return;
                }
                if (!$("#size button").hasClass("active")) {
                    Msg.show("请选择尺寸", 1);
                    return;
                }

                window.location.href = "/DLWXSite/DLGoods/Order?sid=" + Url.get("sid") + "&oid=" + Url.get("oid")
                    + "&styleid=" + $("#styleid").text()
                    + "&color=" + $("#color button.active").text()
                    + "&size=" + $("#size button.active").val()
                    + "&number=" + $("#number input").val();
            })

            //加入购物车
            $("#add").click(function () {

            })


            //颜色按钮
            $("#color button").click(function () {
                $.post("/DLWXSite/DLGoods/GetSize?sid=" + Url.get("sid") + "&oid=" + Url.get("oid") + "&styleid=" + $("#styleid").text() + "&color=" + $(this).text(), function (data) {
                    var rst = eval("(" + data + ")");

                    $("#size button").removeClass("do");
                    for (var i = 0; i < rst.length; i++) {
                        $("#size button[name='" + rst[i].STL2_Size + "']").addClass("do");
                    }
                    $("#size button").not(".do").removeClass("active");
                    $("#size button").not(".do").attr("disabled", "disabled");
                });

                $("#color button").removeClass("active");
            });
            //尺码点击验证有没有存库
            $("#size button").click(function () {
                $.post("/DLWXSite/DLGoods/GetColor?sid=" + Url.get("sid") + "&oid=" + Url.get("oid") + "&styleid=" + $("#styleid").text() + "&size=" + $(this).val(), function (data) {
                    var rst = eval("(" + data + ")");

                    $("#color button").removeClass("do");
                    for (var i = 0; i < rst.length; i++) {
                        $("#color button[name='" + rst[i].STL2_Color + "']").addClass("do");
                    }
                    $("#color button").not(".do").removeClass("active");
                    $("#color button").not(".do").attr("disabled", "disabled");
                });

                $("#size button").removeClass("active");
            });
            //减1
            $("#oMin").click(function () {
                if (parseInt($(this).parent().parent().find("input").val()) <= 1) {
                    $(this).parent().parent().find("input").val("1");
                } else {
                    $(this).parent().parent().find("input").val(parseInt($(this).parent().parent().find("input").val()) - 1);
                }
            });
            //加1
            $("#oPlus").click(function () {;
                if ($.trim($(this).parent().parent().find("input").val()) == "") {
                    $(this).parent().parent().find("input").val("1");
                } else {
                    $(this).parent().parent().find("input").val(parseInt($(this).parent().parent().find("input").val()) + 1);
                }
            });

        })

        function showInfo(ths, id) {
            if ($("#" + id).is(":visible")) {
                $("#" + id).hide();
                $(ths).children().addClass("icon-double-angle-up");
                $(ths).children().removeClass("icon-double-angle-down");
                return;
            }
            else {
                $(ths).children().addClass("icon-double-angle-down");
                $(ths).children().removeClass("icon-double-angle-up");
                $("#" + id).show();
            }
        }

        function add() {
            if (!$("#color button").hasClass("active")) {
                Msg.show("请选择颜色", 1);
                return;
            }
            if (!$("#size button").hasClass("active")) {
                Msg.show("请选择尺寸", 1);
                return;
            }
            //构造提交json的格式
            var paramData = {
                styleid: $("#styleid").text(),
                color: $("#color button.active").text(),
                size: $("#size button.active").val(),
                number: $("#number input").val(),
                price: $("#price").text(),
                sellprice: $("#sellprice").text()
            };

            Msg.show("提交中...", 3);
            $.post("/DLWXSite/DLGoods/AddShoppingCart?sid=" + Url.get("sid") + "&oid=" + Url.get("oid"), paramData, function (data) {
                Msg.hide();
                var rst = eval("(" + data + ")");

                if (rst[0].Result == "True") {
                    Msg.show(rst[0].Message, 0);
                }
                else {
                    Msg.show(rst[0].Message, 1);
                }
            });
        }
    </script>
}

<div id="fullpage">

    @foreach (string s in ViewBag.BigImg)
    {
        <div class="section">
            <img src="http://122.225.19.188:8090@{@s}" >
        </div>
    }
</div>

<div class="skudetailsc">
    <span id="addTry">
        <img style="" src="/Areas/DLWXSite/Resources/images/Goods/sc.jpg" />
    </span>
</div>

<div id="SKUDetail" class="SKUDetailInfo">
    <div style="border: 0px solid #28282a; width: 100%; height: 100%;">
        <div id="CancelSKUDetail">
            <table>
                <tr>
                    <td>×</td>
                </tr>
            </table>
        </div>
        <div id="name" style="margin: 10px; line-height: 15px;">
            <div id="styleid" style="display: none;">@ViewBag.StyleInfo.Rows[0]["STYL_ID"]</div>
            <div id="price" style="display: none;">@ViewBag.StyleInfo.Rows[0]["STYL_price"]</div>
            <div id="sellprice" style="display: none;">@ViewBag.StyleInfo.Rows[0]["STYL_sellprice"] </div>
            <div style="margin: 10px;">
                <p>品名：@ViewBag.StyleInfo.Rows[0]["STYL_name"] </p>
                <p>编号：@ViewBag.StyleInfo.Rows[0]["STYL_Code"] </p>
                <p>价格：@float.Parse(ViewBag.StyleInfo.Rows[0]["STYL_sellprice"]).ToString("0.00") </p>
            </div>
            <hr style="border: 1px solid #7e7e7e;" />
            <div id="sel" style="margin: 10px;">
                <table style="text-align: left;">
                    <tr>
                        <td style="width: 100px;">
                            <p>选择颜色:</p>
                        </td>
                    </tr>
                    <tr>
                        <td id="color">
                            @foreach (System.Data.DataRow dr in ViewBag.Color.Rows)
                            {
                                if (@dr["STL2_Color"] != "")
                                {
                                <button name="@dr["STL2_Color"]" type="button" class="btn" data-toggle="button">@dr["STL2_Color"]</button>
                                }
                            }
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 100px;">
                            <p>选择尺码:</p>
                        </td>
                    </tr>
                    <tr>
                        <td id="size" colspan="2">
                            @foreach (System.Data.DataRow dr in ViewBag.Size.Rows)
                            {
                                if (@dr["STL2_Size"].ToString() != "" && @dr["STL2_Size"].ToString() != "1" && @dr["STL2_Size"].ToString() != "6")
                                {
                                    if (@dr["STL2_Size"].ToString() == "2")
                                    {
                                <button name="@dr["STL2_Size"]" type="button" value="@dr["STL2_Size"]"  class="btn" data-toggle="button" style="width: 70px;" >@dr["STL2_Size"]#S</button>
                                    }
                                    else if (@dr["STL2_Size"].ToString() == "3")
                                    {
                                <button name="@dr["STL2_Size"]" type="button" value="@dr["STL2_Size"]" class="btn" data-toggle="button" style="width: 70px;">@dr["STL2_Size"]#M</button>
                                    }
                                    else if (@dr["STL2_Size"].ToString() == "4")
                                    {
                                <button name="@dr["STL2_Size"]" type="button"  value="@dr["STL2_Size"] "class="btn" data-toggle="button" style="width: 70px;">@dr["STL2_Size"]#L</button>
                                    }
                                    else if (@dr["STL2_Size"].ToString() == "5")
                                    {
                                <button name="@dr["STL2_Size"]" type="button"  value="@dr["STL2_Size"]" class="btn" data-toggle="button" style="width: 70px;">@dr["STL2_Size"]#XL</button>
                                    }
                                }
                            }
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 100px;">
                            <p>选择数量:</p>
                        </td>
                    </tr>
                    <tr>
                        <td id="number" colspan="2">
                            <div class="input-group" style="width: 170px;">
                                <span class="input-group-btn">
                                    <button class="btn btn-default" type="button" id="oMin">-</button>
                                </span>
                                <input style="text-align: center;" type="text" pattern="[0-9]*" class="form-control" value="1">
                                <span class="input-group-btn">
                                    <button class="btn btn-default" type="button" id="oPlus">+</button>
                                </span>
                            </div>
                        </td>
                    </tr>
                </table>
                <hr style="border: 1px solid #7e7e7e;" />
                <div onclick="showInfo(this,'detail')" style="margin: 10px; font-weight: bold; color: #000;">
                    描述<i class="icon-double-angle-up" style="float: right;"></i>
                </div>
                <hr style="border: 1px solid #7e7e7e;" />

                <div style="display: none" id="detail">
                    绚丽多彩的花型特别抢眼，整体给人一种活力时尚的感觉袖子采用纯黑色面料，竖向的拼接能很好的拉长和修饰手臂。       价格与实物请以门店产品为准。
                </div>


            </div>
            <div id="oper">
                <table>
                    <tr>
                        <td id="add" onclick="add()">
                            <img src="~/Areas/DLWXSite/Resources/images/Goods/addbuy.png" width="100%">
                        </td>
                        <td id="order">
                            <img src="~/Areas/DLWXSite/Resources/images/Goods/buy.png" width="100%">
                        </td>
                    </tr>
                </table>

                @* <button id="add" type="button" class="btn btn-success" style="width: 40%; margin: 10px 4%;">加入购物车</button>
                <button id="order" type="button" class="btn btn-success" style="width: 40%; margin: 10px 4%;">我要试穿</button>*@
            </div>
        </div>
    </div>
</div>


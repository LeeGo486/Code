@{
    ViewBag.Title = "GetNearbyShopInfo";
    Layout = "~/Views/Shared/_DLWXSiteLayout.cshtml";
}

@section script{
    <link href="~/Areas/DLWXSite/Resources/Mobile.css?v3" rel="stylesheet" />
    <script type="text/javascript" src="~/Scripts/jweixin-1.0.0.js"></script>
    <script type="text/javascript">
        var appId, ticket, timestamp, nonceStr, signature, latitude, longitude, speed, accuracy;
        $(function () {
            //获取appid
            $.post("/DLWXSite/VIP/GetAppId?sid=" + Url.get("sid") + "&oid=" + Url.get("oid"), function (rst) {
                if (rst.result == 0) {
                    appId = rst.msg;
                    //获取ticket
                    $.post("/DLWXSite/VIP/GetTicket?sid=" + Url.get("sid") + "&oid=" + Url.get("oid"), function (rst) {
                        if (rst.result == 0) {
                            ticket = rst.msg;
                            timestamp = parseInt(new Date().getTime() / 1000) + '';
                            nonceStr = Math.random().toString(36).substr(2, 15);

                            //获取signature
                            $.post("/DLWXSite/VIP/GetSignature?sid=" + Url.get("sid") + "&oid=" + Url.get("oid") + "&ticket=" + ticket + "&nonceStr=" + nonceStr + "&timestamp=" + timestamp + "&url=" + window.location.href.replace(/&/g, '%26'), function (rst) {
                                if (rst.result == 0) {
                                    signature = rst.msg;
                                    wx.config({
                                        debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                                        appId: appId, // 必填，公众号的唯一标识
                                        timestamp: timestamp, // 必填，生成签名的时间戳
                                        nonceStr: nonceStr, // 必填，生成签名的随机串
                                        signature: signature,// 必填，签名，见附录1
                                        jsApiList: [
                                            'getLocation',
                                        ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
                                    });
                                } else {
                                    //alert("获取signature失败")
                                }
                            });
                        } else {
                            //alert("获取GetTicket失败")
                        }
                    });
                } else {
                    //alert("获取appid失败")
                }
            });
        });

        wx.ready(function () {
            wx.getLocation({
                success: function (res) {
                    latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
                    longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
                    speed = res.speed; // 速度，以米/每秒计
                    accuracy = res.accuracy; // 位置精度
                    alert("你的纬度是：" + latitude)



                }
            })
        });
        wx.error(function (res) {
            //alert(res);
        });
    </script>
}

<style>
    .noticList {
        border: 1px solid #e5e5e5;
        background-color: #fff;
        padding: 10px;
        margin-bottom: 12px;
        border-radius: 3px;
        margin: 20px;
    }

    .bottom {
        margin-bottom: 56px;
    }
</style>

<ul style="padding: 0px;">
    <li>
        <img src="~/Areas/DLWXSite/Resources/images/VIP/shopbg.jpg" />
    </li>
</ul>

<div style="margin: 20px">
    <div style="border-bottom: 2px solid #808080; margin: 20px;">
        <span>最近门店</span>
    </div>

    <div style="padding: 15px;">
        <table style="margin-top: -10px">
            <tr>
                <td rowspan="1">
                    <img src="~/Areas/DLWXSite/Resources/images/VIP/shopsearchbg.jpg" style="width: 30%" />
                </td>
                <td style="width: 50%">
                    <span>嘉兴中山西路</span><br />
                    <span>嘉兴中山西路</span>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <hr />
                </td>
            </tr>
            <tr>
                <td rowspan="1">
                    <img src="~/Areas/DLWXSite/Resources/images/VIP/shopsearchbg.jpg" style="width: 30%" />
                </td>
                <td style="width: 50%">
                    <span>嘉兴中山西路</span><br />
                    <span>嘉兴中山西路</span>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <hr />
                </td>
            </tr>
            <tr>
                <td rowspan="1">
                    <img src="~/Areas/DLWXSite/Resources/images/VIP/shopsearchbg.jpg" style="width: 30%" />
                </td>
                <td style="width: 50%">
                    <span>嘉兴中山西路</span><br />
                    <span>嘉兴中山西路</span>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <hr />
                </td>
            </tr>
        </table>

    </div>
</div>

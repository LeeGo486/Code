@{
    ViewBag.Title = "加班申请";
    Layout = "~/Views/Shared/_HRWeiXinLayout.cshtml";
}

@section script{
    <link href="~/Areas/HR/Resources/css/HR.css?v6" rel="stylesheet" />
    <script type="text/javascript">
        var data1 = [];
        $(function () {
            //$("#dav").css("background-color", "#000").css("border-bottom", "2px solid red");
            //$("#dpay").css("background-color", "#2c3e50").css("border-bottom", "");
            var hydp = $('.hzyDp').datepicker().on('changeDate', function (ev) {
                hydp.hide();
            }).data('datepicker');

            $.post("/HR/EHRManagement/ApplyInfo", function (rst) {
                if (rst.result == 0) {
                    data1 = eval(rst.msg);
                } else {
                    Msg.show(rst.msg, rst.result);
                }
            });
        });

        //变更审批人
        function changeAP(approve, name) {
            var $st1 = $("#" + approve);
            var $st1add = $("#" + name);

            var text1 = $st1.find("option:selected").val();   //获取Select选中项的Text一级审批人
            $st1add.empty();

            if (text1 == "0") {
                return;
            } else if (text1 == "1") {
                for (var i = 0; i < data1.length; i++) {
                    if (data1[i].type == text1) {
                        $st1add.append("<option value='" + data1[i].sjC_OID + "'>" + data1[i].sjC_NAME + "</option>");
                    }
                }
            } else if (text1 == "2") {
                for (var i = 0; i < data1.length; i++) {
                    if (data1[i].type == text1) {
                        $st1add.append("<option value='" + data1[i].sjC_OID + "'>" + data1[i].sjC_NAME + "</option>");
                    }
                }
            }
        }
        //确定提交
        function btnSubmit() {

            var OvertimeWorkApplyType = $("#OvertimeWorkApplyType").val();//加班类型
            var OvertimeWorkApplyReason = $("#OvertimeWorkApplyReason").val();//加班原因
            var addchangeAP1 = $("#addapprove1").val();//一级审批
            var addchangeAP2 = $("#addapprove2").val();//二级审批
            if (addchangeAP1 == null) { addchangeAP1 = ""; }
            if (addchangeAP2 == null) { addchangeAP2 = ""; }
            var OvertimeWorkApplyBeginDate = $("#OvertimeWorkApplyBeginDate").val();//开始日期
            var OvertimeWorkApplyEndDate = $("#OvertimeWorkApplyEndDate").val();//结束日期
            var OvertimeWorkApplyBeginTime = $("#OvertimeWorkApplyBeginTime").val();//开始时间
            var OvertimeWorkApplyEndTime = $("#OvertimeWorkApplyEndTime").val();//结束时间

            var OvertimeWorkApplyBeginDateTime = OvertimeWorkApplyBeginDate + " " + OvertimeWorkApplyBeginTime;//开始日期时间
            var OvertimeWorkApplyEndDateTime = OvertimeWorkApplyEndDate + " " + OvertimeWorkApplyEndTime;//结束日期时间

            var OvertimeWorkApplyHours = $("#OvertimeWorkApplyHours").val();//加班时长
            var OvertimeWorkApplyRemark = $("#OvertimeWorkApplyRemark").val();//备注


            if ($.trim($("#OvertimeWorkApplyType").val()).length <= 0) { $("#OvertimeWorkApplyType").focus(); Msg.show('加班类型!', 1); return; }
            if ($.trim($("#OvertimeWorkApplyReason").val()).length <= 0) { $("#OvertimeWorkApplyReason").focus(); Msg.show('加班原因!', 1); return; }

            if ($.trim($("#OvertimeWorkApplyBeginDate").val()).length <= 0) { $("#OvertimeWorkApplyBeginDate").focus(); Msg.show('开始日期!', 1); return; }
            if ($.trim($("#OvertimeWorkApplyEndDate").val()).length <= 0) { $("#OvertimeWorkApplyEndDate").focus(); Msg.show('结束日期!', 1); return; }
            if ($.trim($("#OvertimeWorkApplyBeginTime").val()).length <= 0) { $("#OvertimeWorkApplyBeginTime").focus(); Msg.show('开始时间!', 1); return; }
            if ($.trim($("#OvertimeWorkApplyEndTime").val()).length <= 0) { $("#OvertimeWorkApplyEndTime").focus(); Msg.show('结束时间!', 1); return; }

            if ($.trim($("#OvertimeWorkApplyHours").val()).length <= 0) { $("#OvertimeWorkApplyHours").focus(); Msg.show('加班时长!', 1); return; }
            if ($.trim($("#OvertimeWorkApplyRemark").val()).length <= 0) { $("#OvertimeWorkApplyRemark").focus(); Msg.show('备注!', 1); return; }
            if (addchangeAP2 == "" && addchangeAP1 == "") { Msg.show("请选择审批人!", 1); return; }

            var dataOW = {
                sp1: addchangeAP1,
                c_remark: OvertimeWorkApplyRemark,
                begindate: OvertimeWorkApplyBeginDateTime,
                enddate: OvertimeWorkApplyEndDateTime,
                c_value: OvertimeWorkApplyHours,
                c_reason: OvertimeWorkApplyReason,
                c_attitemid: OvertimeWorkApplyType,
            };
            Msg.show("提交中请稍后...", 3);
            $.post("/HR/EHRManagement/OverTimeApplySubmit", dataOW, function (rst) {
                Msg.hide();

                if (rst.result == 0) {
                    Msg.show(rst.msg, rst.result);
                    window.location.href = '/HR/EHRManagement/AvInfo'
                } else {
                    Msg.show(rst.msg, rst.result);
                }
                $("#btnSubmit").button("reset");
            });
        }

    </script>
}
<div class="mainArea">
    <h4><span><i class="glyphicon glyphicon-calendar"></i>&nbsp;&nbsp;加班申请</span></h4>

    <div class="input-group">
        <span class="input-group-addon">加班类型</span>
        <select id="OvertimeWorkApplyType" class="form-control">
            <option value="">- - - -</option>
            <option value="3847483">工作日加班</option>
            <option value="3847485">休息日加班</option>
            <option value="107872343">公休日加班</option>
        </select>
    </div>
    <br />
    <div class="input-group">
        <span class="input-group-addon">加班原因</span>
        <select id="OvertimeWorkApplyReason" class="form-control">
            <option value="">- - - -</option>
            <option value="1">根据生产计划加班</option>
            <option value="2">临时加班</option>
            <option value="3">其它原因</option>
        </select>
    </div>
    <br />

    <div class="input-group">
        <span class="input-group-addon">审批人(1)</span>
        <select id="changeAP1" class="form-control" onchange="changeAP('changeAP1','addapprove1')">
            <option value="">- - - -</option>
            <option value="1">一级审批人</option>
            <option value="2">二级审批人</option>
        </select>
        <select id="addapprove1" class="form-control">
        </select>
    </div>
    <h4><span><i class="glyphicon glyphicon-user"></i>&nbsp;&nbsp;不需要2个审批人不用填写</span></h4>
    <div class="input-group">
        <span class="input-group-addon">审批人(2)</span>
        <select id="changeAP2" class="form-control" onchange="changeAP('changeAP2','addapprove2')">
            <option value="">- - - -</option>
            <option value="1">一级审批人</option>
            <option value="2">二级审批人</option>
        </select>
        <select id="addapprove2" class="form-control">
        </select>
    </div>
    <br />
    <div class="input-group date form_date">
        <span class="input-group-addon">开始时间</span>
        <input class="form-control hzyDp" id="OvertimeWorkApplyBeginDate" name="OvertimeWorkApplyBeginDate" type="text" style="width: 105px" data-date-format="yyyy-mm-dd" readonly="">
        <span class="input-group-addon"></span>
        <input type="time" id="OvertimeWorkApplyBeginTime" name="OvertimeWorkApplyBeginTime" class="form-control" placeholder="08:00:00">
    </div>
    <br />
    <div class="input-group date form_date">
        <span class="input-group-addon">结束时间</span>
        <input class="form-control hzyDp" id="OvertimeWorkApplyEndDate" name="OvertimeWorkApplyEndDate" type="text" style="width: 105px" data-date-format="yyyy-mm-dd" readonly="">
        <span class="input-group-addon"></span>
        <input type="time" id="OvertimeWorkApplyEndTime" name="OvertimeWorkApplyEndTime" class="form-control" placeholder="08:00:00">
    </div>

    <br />
    <div class="input-group">
        <span class="input-group-addon">加班时长</span>
        <input type="number" id="OvertimeWorkApplyHours" name="OvertimeWorkApplyHours" class="form-control" placeholder="加班时长">
    </div>
    <br />
    <div class="input-group">
        <span class="input-group-addon">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注</span>
        <input type="text" id="OvertimeWorkApplyRemark" name="OvertimeWorkApplyRemark" class="form-control" placeholder="备注">
    </div>
    <input id="btnSubmit" type="button" value="申请确定" class="btn btn-success" style="width: 100%; margin-top: 30px;" onclick="btnSubmit()" />
</div>

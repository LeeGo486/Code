using System;
using System.Linq;
using ElegantWM.EntityModel;
using ElegantWM.IDAL;
using System.Data;
using System.Data.SqlClient;

/**
 * 作者：LeeGo
 * 时间：2015-06-24 17:42:31
 * 功能：数据访问层
 * 版本：V1.0
 * 网站：http://www.chinacloudtech.com
 * ------------------------------------
 * 修改人：
 * 修改时间：
 * 修改内容：
 * 版本： 
 **/

namespace ElegantWM.DAL
{
    public class Game_LittleModelDAL : EFRepository<Game_LittleModelInfo>, IGame_LittleModelDAL
    {
        /* 如果是多数据库，请开启        */
        public Game_LittleModelDAL()
            : base("Activities")
        {

        }

        #region 获取小模特信息
        public DataTable GetLittleModelInfo(string strWhere, int iPage, int iGroup)
        {
            string strSQL = @"SELECT TOP 10 [L_ID]
                                    ,[L_No]
                                    ,[L_Name]
                                    ,[L_Group]
                                    ,[L_PicPath]
                                    ,ISNULL(SUM([R_Ticket]),0) AS Result
                             FROM [dbo].[Game_LittleModelInfo] T1
                             LEFT JOIN [dbo].[Game_LittleModelResult] T2 ON T1.L_Id = T2.R_LID
                             WHERE 1=1 ";
            if (iGroup != 0) {
                strSQL += "AND L_Group = " + iGroup;
            };
            if (strWhere != "") {
                strSQL += "AND" + strWhere;
            };
            if (iGroup != 0 && iPage != 0) {
                strSQL += "AND L_ID NOT IN (SELECT TOP "+10 * (iPage - 1) + " L_ID FROM dbo.Game_LittleModelInfo WHERE L_Group = " + iGroup + ")";
            };
                
            strSQL += @"GROUP BY [L_ID],[L_Name],[L_Group],[L_PicPath],[L_No]
                        ORDER BY Result DESC,L_ID ASC";
            return Query(strSQL, null);
        }
        #endregion  

        #region 获取行数

        public DataTable GetLittleModelCount(int iGroup) {

            string strSQL = @"SELECT COUNT(1) 
                              FROM [dbo].[Game_LittleModelInfo]
                              WHERE L_Group = " + iGroup;
            return Query(strSQL, null);
        }
        #endregion

    }
}

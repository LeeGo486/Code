using ElegantWM.DAL;
using ElegantWM.IBLL;
using ElegantWM.IDAL;
using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using ElegantWM.Tools;
using ElegantWM.DTO;

namespace ElegantWM.BLL
{
    public class WsrrService : IWsrrService
    {
        private IWsrrDAL dal = new WsrrDAL();

        #region 短信验证码通用调用的WSRR
        /// <summary>
        /// 发送短信验证码
        /// </summary>
        /// <param name="tel"></param>
        /// <returns></returns>
        public DataTable SendSmsAnyTelCommonInterface(string phone, string system, string com)
        {
            DataSet ds = dal.ExcuteWsrr("5a7b9005-f3a3-4543-b7b2-3adb705220d2", @"<XML><ROOT><OPTYPE>GetAuthCode</OPTYPE><LIST><ROW>
                 <AuthType>signup</AuthType>
                 <Phone>" + phone + @"</Phone>
                 <System>" + system + @"</System>
                 <Com>" + com + @"</Com>
                 </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }
        /// <summary>
        /// 短信验证码通用
        /// </summary>
        /// <param name="VipTel"></param>
        /// <param name="AuthCode"></param>
        /// <returns></returns>
        public DataTable CheckAuthCodeCommonInterface(string phone, string AuthCode)
        {
            DataSet ds = dal.ExcuteWsrr("5a7b9005-f3a3-4543-b7b2-3adb705220d22", @"<XML><ROOT><OPTYPE>CheckAuthCode</OPTYPE><LIST><ROW>
                <Phone>" + phone + @"</Phone>
                <AuthCode>" + AuthCode + @"</AuthCode>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        #endregion

        #region 3S调用的WSRR
        /// <summary>
        /// 根据手机获取vip名称和消费金额
        /// </summary>
        /// <param name="tel"></param>
        /// <returns></returns>
        public string GetVipInfo(string tel)
        {
            DataSet ds = dal.GetData("f783dfa4-a987-44b6-a1a8-9da100f6d42a", "【操作类型,GET】【CONO,HYFG】【DIVI,D01】【项目,3S】【实体,tc_account】【手机号码," + tel.Replace("'", "").Replace("】", "").Replace("【", "") + "】");
            DataTable dt = ds.Tables[1];
            return JsonHelper.ToJson(dt);
        }

        /// <summary>
        /// 校验产品是否存在
        /// </summary>
        /// <param name="skc"></param>
        /// <returns></returns>
        public DataTable CheckSKC(string skc)
        {
            DataSet ds = dal.GetData("f783dfa4-a987-44b6-a1a8-9da100f6d42a", "【操作类型,GET】【CONO,HYFG】【DIVI,D01】【项目,3S】【实体,J_CLOTHING】【SKU," + skc.Replace("'", "").Replace("】", "").Replace("【", "") + "】");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 根据当前登录账号获取店铺信息
        /// </summary>
        /// <param name="depotid"></param>
        /// <returns></returns>
        public DataTable GetUserDeptInfo(string depotid)
        {
            DataSet ds = dal.GetData("f783dfa4-a987-44b6-a1a8-9da100f6d42a", "【操作类型,GET】【CONO,HYFG】【DIVI,D01】【项目,3S】【实体,J_DEPOT】【店铺编号," + depotid.Replace("'", "").Replace("】", "").Replace("【", "") + "】");
            DataTable dt = ds.Tables[1];
            return dt;
        }


        /// <summary>
        /// 发送短信验证码
        /// </summary>
        /// <param name="tel"></param>
        /// <returns></returns>
        public DataTable SendSMS(string tel)
        {
            DataSet ds = dal.ExcuteWsrr("33c7b95c-790c-4841-a738-b7994fb0f932", "<XML><ROOT><OPTYPE>GetAuthCode</OPTYPE><LIST><ROW><AuthType>signup</AuthType><Phone>" + tel + "</Phone></ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// S3用户注册
        /// </summary>
        /// <param name="tel"></param>
        /// <param name="oid"></param>
        /// <param name="pwd"></param>
        /// <param name="code"></param>
        /// <returns></returns>
        public DataTable Register3S(string tel, string oid, string pwd, string code)
        {
            DataSet ds = dal.ExcuteWsrr("711bb78a-4190-4568-809b-45c94dc54fb3", "<XML><ROOT><OPTYPE>SignUp</OPTYPE><LIST><ROW><LoginUser>" + tel + "</LoginUser><PassWord>" + pwd + "</PassWord><AccreditationType>3SWeChat</AccreditationType><BindUser>" + oid + "</BindUser><BindPassWord></BindPassWord><AuthCode>" + code + "</AuthCode></ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }


        /// <summary>
        /// wsrr判断是否离职，绑定，获取店铺名称，编号等基本信息
        /// </summary>
        /// <param name="oid"></param>
        /// <returns></returns>
        public DataTable CheckS3UserBind(string oid)
        {
            string xml = @"<XML><ROOT><OPTYPE>GetEmployeeInfoBy3SWeChat</OPTYPE><LIST><ROW><S3WeChatID>{0}</S3WeChatID></ROW></LIST></ROOT></XML>";
            xml = string.Format(xml, oid);
            DataSet ds = dal.ExcuteWsrr("fb82083d-23f3-432d-a612-676cad04c01f", xml);
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 绑定EHR和POS
        /// </summary>
        /// <param name="tel"></param>
        /// <param name="ehrName"></param>
        /// <param name="idCode"></param>
        /// <param name="posCode"></param>
        /// <returns></returns>
        public DataTable BindEhrDrp(string tel, string ehrName, string idCode, string posCode, bool isRePos = false)
        {
            if (!isRePos)
            {
                string ehrXML = @"<XML><ROOT><OPTYPE>Bind</OPTYPE><LIST>
                                <ROW>
	                                <LoginUser>{0}</LoginUser>
	                                <PassWord></PassWord>
	                                <AccreditationType>EHRCARD</AccreditationType>
	                                <BindUser>{1}</BindUser>
	                                <BindPassWord>{2}</BindPassWord>
                                </ROW>
                                </LIST></ROOT></XML>";

                DataSet ds = dal.ExcuteWsrr("711bb78a-4190-4568-809b-45c94dc54fb3", string.Format(ehrXML, tel, ehrName, idCode));
                DataTable dt = ds.Tables[1];
                if (dt.Rows[0][0].ToString().ToLower() != "true")
                {
                    throw new Exception(dt.Rows[0][1].ToString());
                }
            }
            string posXML = @"<XML><ROOT><OPTYPE>Bind</OPTYPE><LIST>
                                <ROW>
	                                <LoginUser>{0}</LoginUser>
	                                <PassWord></PassWord>
	                                <AccreditationType>POSEmployee</AccreditationType>
	                                <BindUser>{1}</BindUser>
	                                <BindPassWord></BindPassWord>
                                </ROW>
                                </LIST></ROOT></XML>";
            DataSet ds2 = dal.ExcuteWsrr("711bb78a-4190-4568-809b-45c94dc54fb3", string.Format(posXML, tel, posCode));
            DataTable dt2 = ds2.Tables[1];
            return dt2;
        }

        #endregion

        #region Npaia调用的WSRR
        /// <summary>
        /// NPaia手机验证码验证
        /// </summary>
        /// <param name="VipTel"></param>
        /// <param name="AuthCode"></param>
        /// <returns></returns>
        public DataTable CheckAuthCode(string VipTel, string AuthCode)
        {
            DataSet ds = dal.ExcuteWsrr("9a7f4f2b-e6b1-4840-b92d-ccf06120c8f2", @"<XML><ROOT><OPTYPE>CheckAuthCode</OPTYPE><LIST><ROW>
                <Phone>" + VipTel + @"</Phone>
                <AuthCode>" + AuthCode + @"</AuthCode>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// NPaia发送短信验证码
        /// </summary>
        /// <param name="tel"></param>
        /// <returns></returns>
        public DataTable SendSmsAnyTel(string tel)
        {
            DataSet ds = dal.ExcuteWsrr("9a7f4f2b-e6b1-4840-b92d-ccf06120c8f2", @"<XML><ROOT><OPTYPE>GetAuthCode</OPTYPE><LIST><ROW>
                 <AuthType>signup</AuthType><Phone>" + tel + @"</Phone>
                 </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// NPaia雅根据当前登录手机号码获取VIP积分和判断是否存在会员
        /// </summary>
        /// <param name="viptel"></param>
        /// <returns></returns>
        public DataTable GetUserCentumInfo(string viptel)
        {
            DataSet ds = dal.ExcuteWsrr("95cc444d-8376-4305-8385-b7b0e00309cb", @"<XML><ROOT><OPTYPE>GETVIPINTEGRAL</OPTYPE><LIST><ROW>
                      <Phone>" + viptel + @"</Phone>
                      </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 新增XYdrp会员信息和DRP VIP信息
        /// </summary>
        /// <param name="viptel"></param>
        /// <returns></returns>
        public DataTable VipUserForC3(string VipTel, string VipSex, string VipName)
        {
            DataSet ds = dal.ExcuteWsrr("95cc444d-8376-4305-8385-b7b0e00309cb", @"<XML><ROOT><OPTYPE>EDITVIPPersonnel</OPTYPE><LIST>
                        <ROW><Phone>" + VipTel + @"</Phone>
                        <vipname>" + VipName + @"</vipname>
                        <vipsex>" + VipSex + @"</vipsex>
                        </ROW> </LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 查询款式信息
        /// </summary>
        /// <param name="where"></param>
        /// <returns></returns>
        public DataTable GetStyleInfo(string where)
        {
            DataSet ds = dal.ExcuteWsrr("df8dc27e-703a-4f79-ac01-f9efe6dfad1f", @"<XML><ROOT><OPTYPE>GetStyleInfo</OPTYPE></ROOT></XML>
                                        <WHERE>" + where + "</WHERE>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 查询款式SKU信息
        /// </summary>
        /// <param name="where"></param>
        /// <returns></returns>
        public DataTable GetStyleSKU(string where)
        {
            DataSet ds = dal.ExcuteWsrr("df8dc27e-703a-4f79-ac01-f9efe6dfad1f", @"<XML><ROOT><OPTYPE>GetStyleSKU</OPTYPE></ROOT></XML>
                                        <WHERE>" + where + "</WHERE>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 添加购物车信息
        /// </summary>
        /// <param name="oid"></param>
        /// <returns></returns>
        public DataTable AddShoppingCart(string oid, string skuid, string number, string price, string sellprice, string name)
        {
            DataSet ds = dal.ExcuteWsrr("1284d288-da3f-4ce0-893f-8d96cf2ec2cd", @"<XML><ROOT><OPTYPE>AddShoppingCart</OPTYPE>
                                        <LIST><ROW><WeiXinID>" + oid + "</WeiXinID><STL2_ID>" + skuid + "</STL2_ID><Number>" + number + "</Number><Price>" + price + "</Price><SellPrice>" + sellprice + "</SellPrice><RgUser>" + name + "</RgUser></ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 查询购物车信息
        /// </summary>
        /// <param name="where"></param>
        /// <returns></returns>
        public DataTable GetShoppingCart(string where)
        {
            DataSet ds = dal.ExcuteWsrr("1284d288-da3f-4ce0-893f-8d96cf2ec2cd", @"<XML><ROOT><OPTYPE>GetShoppingCart</OPTYPE></ROOT></XML>
                                        <WHERE>" + where + "</WHERE>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 删除购物车信息
        /// </summary>
        /// <param name="id"></param>
        /// <returns></returns>
        public DataTable DelShoppingCart(string id)
        {
            DataSet ds = dal.ExcuteWsrr("1284d288-da3f-4ce0-893f-8d96cf2ec2cd", @"<XML><ROOT><OPTYPE>DelShoppingCart</OPTYPE><LIST><ROW><ID>" + id + "</ID></ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 添加订单信息
        /// </summary>
        /// <param name="oid"></param>
        /// <param name="head"></param>
        /// <returns></returns>
        public DataTable AddOrder(string oid, OrderHeadDto head)
        {
            string s = "<XML><ROOT><OPTYPE>AddCustomerOrder</OPTYPE><LIST><ROW><WeiXinID>" + oid + "</WeiXinID><DeliveryDate>" + head.Deliverydate + "</DeliveryDate><Amount>" + head.Amount + "</Amount><DEPT_ID>" + head.Depotid + "</DEPT_ID><Desp>" + head.Desp + "</Desp><RgUser>" + head.RgUser + "</RgUser><Phone>" + head.Tel + "</Phone></ROW></LIST>";

            s = s + "<LIST>";
            for (int i = 0; i < head.Detail.Count; i++)
            {
                s = s + "<ROW><ID>" + head.Detail[i].id + "</ID><STL2_ID>" + head.Detail[i].Stlid + "</STL2_ID><DeliveryDate>" + head.Detail[i].Deliverydate + "</DeliveryDate><Number>" + head.Detail[i].Number + "</Number><Price>" + head.Detail[i].Price + "</Price><SellPrice>" + head.Detail[i].SellPrice + "</SellPrice><Amount>" + head.Detail[i].Amount + "</Amount></ROW>";
            }
            s = s + "</LIST>";
            s = s + "</ROOT></XML>";

            DataSet ds = dal.ExcuteWsrr("150fb7e6-111a-4752-a7c5-546ad9d169a4", s);
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 根据主题查询款式SKU信息
        /// </summary>
        /// <param name="where"></param>
        /// <returns></returns>
        public DataTable GetStyleSKUByTheme(string where)
        {
            DataSet ds = dal.ExcuteWsrr("eb226fa0-fdb3-4ce5-8e88-90d8bc73cf79", @"<XML><ROOT><OPTYPE>GetStyleByTheme</OPTYPE><List><Rows></Rows></List></ROOT></XML>
                                        <WHERE>" + where + "</WHERE>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 查询订单信息
        /// </summary>
        /// <param name="where"></param>
        /// <returns></returns>
        public DataTable GetOrder(string where)
        {
            DataSet ds = dal.ExcuteWsrr("150fb7e6-111a-4752-a7c5-546ad9d169a4", @"<XML><ROOT><OPTYPE>GetCustomerOrder</OPTYPE></ROOT></XML>
                                        <WHERE>" + where + "</WHERE>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 查询省份信息
        /// </summary>
        /// <returns></returns>
        public DataTable GetProvince()
        {
            DataSet ds = dal.ExcuteWsrr("8501f40e-134f-4f6d-b604-b37705c986d1", @"<XML><ROOT><OPTYPE>GetDepot</OPTYPE></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 查询市信息
        /// </summary>
        /// <param name="where"></param>
        /// <returns></returns>
        public DataTable GetCity(string where)
        {
            DataSet ds = dal.ExcuteWsrr("8501f40e-134f-4f6d-b604-b37705c986d1", @"<XML><ROOT><OPTYPE>GetDepot</OPTYPE></ROOT></XML>
                                        <WHERE>" + where + "</WHERE>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 查询市信息
        /// </summary>
        /// <param name="where"></param>
        /// <returns></returns>
        public DataTable GetDepot(string where)
        {
            DataSet ds = dal.ExcuteWsrr("8501f40e-134f-4f6d-b604-b37705c986d1", @"<XML><ROOT><OPTYPE>GetDepot</OPTYPE></ROOT></XML>
                                        <WHERE>" + where + "</WHERE>");
            DataTable dt = ds.Tables[1];
            return dt;
        }
        #endregion

        #region VexSSO手机号登录相关方法
        /// <summary>
        /// 注册并绑定AM
        /// </summary>
        /// <param name="tel">手机</param>
        /// <returns></returns>
        public DataTable VexSSORegAndBindAM(string tel, string pwd, string amuser, string ampwd, string code, bool reged)
        {
            if (reged) //已注册用户直接绑定
                return VexSSOBind(tel, pwd, "AM", amuser, ampwd);
            DataSet ds = dal.ExcuteWsrr("711bb78a-4190-4568-809b-45c94dc54fb3", "<XML><ROOT><OPTYPE>SignUp</OPTYPE><LIST><ROW><LoginUser>" + tel + "</LoginUser><PassWord>" + pwd + "</PassWord><AccreditationType>AM</AccreditationType><BindUser>" + amuser + "</BindUser><BindPassWord>" + ampwd + "</BindPassWord><AuthCode>" + code + "</AuthCode></ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }
        /// <summary>
        /// 用户绑定，系统用户和手机号绑定
        /// </summary>
        /// <param name="tel"></param>
        /// <param name="pwd"></param>
        /// <param name="type"></param>
        /// <param name="destuser"></param>
        /// <param name="destpwd"></param>
        /// <returns></returns>
        public DataTable VexSSOBind(string tel, string pwd, string type, string destuser, string destpwd)
        {
            DataSet ds = dal.ExcuteWsrr("711bb78a-4190-4568-809b-45c94dc54fb3", "<XML><ROOT><OPTYPE>Bind</OPTYPE><LIST><ROW><LoginUser>" + tel + "</LoginUser><PassWord>" + pwd + "</PassWord><AccreditationType>" + type + "</AccreditationType><BindUser>" + destuser + "</BindUser><BindPassWord>" + destpwd + "</BindPassWord></ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 获取验证码，用于找回密码
        /// </summary>
        /// <param name="tel"></param>
        /// <returns></returns>
        public DataTable VexSSOGetPwdCode(string tel)
        {
            DataSet ds = dal.ExcuteWsrr("33c7b95c-790c-4841-a738-b7994fb0f932", "<XML><ROOT><OPTYPE>GetAuthCode</OPTYPE><LIST><ROW><AuthType>getPassword</AuthType><Phone>" + tel + "</Phone></ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 将密码发送到手机
        /// </summary>
        /// <param name="tel"></param>
        /// <param name="code"></param>
        /// <returns></returns>
        public DataTable VexSSOSendPwd2Phone(string tel, string code)
        {
            DataSet ds = dal.ExcuteWsrr("711bb78a-4190-4568-809b-45c94dc54fb3", "<XML><ROOT><OPTYPE>GetPassWord</OPTYPE><LIST><ROW><LoginUser>" + tel + "</LoginUser><AuthCode>" + code + "</AuthCode></ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 立即更新C3AM的用户名和密码
        /// </summary>
        /// <param name="amuser"></param>
        /// <param name="tel"></param>
        /// <param name="pwd"></param>
        public void UpdateC3AMUser(string amuser, string tel, string pwd)
        {
            dal.UpdateC3AMUser(amuser, tel, pwd);
        }
        #endregion

        #region CMT调用的WSRR
        public DataTable GetTaskView(string where)
        {
            DataSet ds = dal.GetData("f50694ed-b48c-4949-ba32-72e003fca76a", where);
            DataTable dt = ds.Tables[1];
            return dt;
        }

        public DataTable GetCustomerInfo(string where)
        {
            DataSet ds = dal.ExcuteWsrr("0078b5a7-2209-4d82-90a1-907ee84c5c03", @"<XML><ROOT><OPTYPE>GetCustomerInfo</OPTYPE></ROOT></XML>
                                            <WHERE>" + where + "</WHERE>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        public DataSet GetTaskDetail(string aml)
        {
            string strRst = dal.ExcuteWsrrAML("f50694ed-b48c-4949-ba32-72e003fca76a", aml);
            DataSet ds = XmlHelper.GetDSByExcelXML(strRst, false, false);
            string strRstTemp = ds.Tables[0].Rows[0][0].ToString();
            DataSet dsRst = XmlHelper.GetDSByExcelXML(strRstTemp, false, false);
            return dsRst;
        }

        public DataTable GetFruit(string where)
        {
            DataSet ds = dal.ExcuteWsrr("0078b5a7-2209-4d82-90a1-907ee84c5c03", @"<XML><ROOT><OPTYPE>GetFruit</OPTYPE><LIST>
                                            <ROWS><Type>" + where + "</Type></ROWS></LIST></ROOT></XML>");

            DataTable dt = ds.Tables[1];
            return dt;
        }

        public DataTable Refuse(string where)
        {
            DataSet ds = dal.ExcuteWsrr("0078b5a7-2209-4d82-90a1-907ee84c5c03", @"<XML><ROOT><OPTYPE>Refuse</OPTYPE>
                                            <LIST><ROWS><Type>" + where + "</Type></ROWS></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        public DataTable FBSumbit(string xml)
        {
            DataSet ds = dal.ExcuteWsrr("0078b5a7-2209-4d82-90a1-907ee84c5c03", @"<XML><ROOT><OPTYPE>Submit</OPTYPE>
                                            <LIST><ROWS>" + xml + "</ROWS></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        public DataTable FeedBackSumbitArrival(string xml)
        {
            DataSet ds = dal.ExcuteWsrr("0078b5a7-2209-4d82-90a1-907ee84c5c03", @"<XML><ROOT><OPTYPE>SubmitArrival</OPTYPE>
                                            <LIST><ROWS>" + xml + "</ROWS></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// 获取导购列表
        /// </summary>
        /// <param name="Depotid"></param>
        /// <returns></returns>
        public DataTable SellerList(string Depotid)
        {
            DataSet ds = dal.ExcuteWsrr("70f9ed84-b972-48f3-b427-69f106581848", @"<XML><ROOT><OPTYPE>GETEMPLOYEEBASE</OPTYPE>
                                            <LIST><ROWS><depotid>" + Depotid + "</depotid></ROWS></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];

            return dt;
        }

        #endregion

        #region 3S薪资条调用的WSRR
        /// <summary>
        ///3S薪资条调用的WSRR
        /// </summary>
        ///
        /// <param name="身份证号"></param>
        /// <returns></returns>
        public DataTable GetShopPay(string IdentityCard, string year, string month)
        {
            DataSet ds = dal.ExcuteWsrr("cd7fbadc-0629-4756-8b0d-3f89e4fb3fbf", @"<XML><ROOT><OPTYPE>EHRForShopPay</OPTYPE><LIST><ROW>
                <IdentityCard>" + IdentityCard + @"</IdentityCard>
                <year>" + year + @"</year>
                <month>" + month + @"</month>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///根据微信号获取身份证
        /// </summary>
        /// <param name="oid"></param>
        /// <returns></returns>
        public DataTable GetIdentityCardInfo(string oid)
        {
            DataSet ds = dal.ExcuteWsrr("eeb77f75-5902-4d0f-b99a-57ef20c21d2b", @"<XML><ROOT><OPTYPE>GetIdentityCardInfo</OPTYPE><LIST><ROW>
                <oid>" + oid + @"</oid>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        #endregion

        #region EHR考勤
        /// <summary>
        /// EHR考勤验证登入信息
        /// </summary>
        /// <param name="UserName"></param>
        /// <param name="password"></param>
        /// <returns></returns>
        public DataTable CheckLogin(string UserName, string password)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>CheckDologin</OPTYPE><LIST><ROW>
                <name>" + UserName + @"</name>
                <password>" + password + @"</password>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        /// EHR公告信息
        /// </summary>
        /// <returns></returns>
        public DataTable GetNotic()
        {
            DataSet ds = dal.ExcuteWsrr("f1a2f406-c0ae-4fef-a62d-3be8c522d0a0", @"<XML><ROOT><OPTYPE>GetNoticForPTP</OPTYPE><LIST><ROW>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///薪资条调用的WSRR
        /// </summary>
        /// <param name="年"></param>
        /// <param name="月"></param>
        /// <param name="身份证号"></param>
        /// <returns></returns>
        public DataTable GetEHRForSalary(string password, string IdentityCard, string year, string month)
        {
            DataSet ds = dal.ExcuteWsrr("6caa05b7-cb78-4fb1-9f27-2e61df5c09c6", @"<XML><ROOT><OPTYPE>GetEHRForSalary</OPTYPE><LIST><ROW>
                <password>" + password + @"</password>
                <sfz>" + IdentityCard + @"</sfz>
                <year>" + year + @"</year>
                <month>" + month + @"</month>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///打卡查询
        /// </summary>
        /// <param name="年"></param>
        /// <param name="月"></param>
        /// <param name="身份证号"></param>
        /// <returns></returns>
        public DataTable AttendanceGet(string IdentityCard, string year, string month)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>GetCheckWorkAttendance</OPTYPE><LIST><ROW>
                <sfz>" + IdentityCard + @"</sfz>
                <year>" + year + @"</year>
                <month>" + month + @"</month>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///补签考勤查询
        /// </summary>
        /// <param name="年"></param>
        /// <param name="月"></param>
        /// <param name="身份证号"></param>
        /// <returns></returns>
        public DataTable AttendanceGetApply(string IdentityCard, string year, string month)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>GetMangeCardRecordInfo</OPTYPE><LIST><ROW>
                <sfz>" + IdentityCard + @"</sfz>
                <year>" + year + @"</year>
                <month>" + month + @"</month>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///审批人
        /// </summary>
        /// <param name="m_c_oid"></param>
        /// <param name="身份证号"></param>
        /// <returns></returns>
        public DataTable ApplyInfo(string m_c_oid, string m_sfz)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>ApplyInfo</OPTYPE><LIST><ROW>
                <c_oid>" + m_c_oid + @"</c_oid>
                <sfz>" + m_sfz + @"</sfz>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///考勤提交
        /// </summary>
        /// <param name="m_c_oid"></param>
        /// <param name="身份证号"></param>
        /// <returns></returns>
        /// 
        public DataTable AttendanceSubmit(string name, string adddate, string adddate1, string adddate2, string addcause, string addchangeap1,
                                          string addchangeap2, string addremarks, string c_oid)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>ApplyEdit</OPTYPE><LIST><ROW>
                <name>" + name + @"</name>
                <adddate>" + adddate + @"</adddate>
                <adddate1>" + adddate1 + @"</adddate1>
                <adddate2>" + adddate2 + @"</adddate2>
                <addcause>" + addcause + @"</addcause>
                <addchangeap1>" + addchangeap1 + @"</addchangeap1>
                <addchangeap2>" + addchangeap2 + @"</addchangeap2>
                <addremarks>" + addremarks + @"</addremarks>
                <c_oid>" + c_oid + @"</c_oid>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///获取审批考勤数据
        /// </summary>
        /// <param name="m_c_oid"></param>
        /// <returns></returns>
        public DataTable AttendanceGetApprove(string oid)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>GetApprove</OPTYPE><LIST><ROW>
                <oid>" + oid + @"</oid>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///审批考勤数据
        /// </summary>
        /// <param name="m_c_oid"></param>
        /// <returns></returns>
        public DataTable AttendanceApproveSubmit(string apptype, string c_oid, string m_oid_user, string c_approveflowid,
                                                 string c_oid_renewcardsign, string c_remark, string c_renewremark)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>Approve</OPTYPE><LIST><ROW>
                <apptype>" + apptype + @"</apptype>
                <c_oid>" + c_oid + @"</c_oid>
                <m_oid_user>" + m_oid_user + @"</m_oid_user>
                <c_approveflowid>" + c_approveflowid + @"</c_approveflowid>
                <c_oid_renewcardsign>" + c_oid_renewcardsign + @"</c_oid_renewcardsign>
                <c_remark>" + c_remark + @"</c_remark>
                <c_renewremark>" + c_renewremark + @"</c_renewremark>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }


        /// <summary>
        ///加班记录
        /// </summary>
        /// <param name="年"></param>
        /// <param name="月"></param>
        /// <param name="身份证号"></param>
        /// <returns></returns>
        public DataTable OverTimeGet(string c_oid, string year, string month)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>GetOvertimeSearch</OPTYPE><LIST><ROW>
                <c_oid>" + c_oid + @"</c_oid>
                <year>" + year + @"</year>
                <month>" + month + @"</month>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///加班申请提交
        /// </summary>
        /// <param name="c_oid"></param>
        /// <returns></returns>
        public DataTable OverTimeApplySubmit(string c_oid, string sp1, string c_remark, string begindate, string enddate, string c_value, string c_reason, string c_attitemid)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>ApplyOvertime</OPTYPE><LIST><ROW>
                <c_oid>" + c_oid + @"</c_oid>
                <sp1>" + sp1 + @"</sp1>
                <c_remark>" + c_remark + @"</c_remark>
                <begindate>" + begindate + @"</begindate>
                <enddate>" + enddate + @"</enddate>
                <c_value>" + c_value + @"</c_value>
                <c_reason>" + c_reason + @"</c_reason>
                <c_attitemid>" + c_attitemid + @"</c_attitemid>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///获取加班审批数据
        /// </summary>
        /// <param name="m_c_oid"></param>
        /// <returns></returns>
        public DataTable OverTimeGetApprove(string c_oid)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>GetApplyOvertime</OPTYPE><LIST><ROW>
                <c_oid>" + c_oid + @"</c_oid>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }
        /// <summary>
        ///审批加班数据
        /// </summary>
        /// <param name="m_c_oid"></param>
        /// <returns></returns>
        public DataTable OverTimeApproveSubmit(string c_oid_overtimeapply, string applec_oid, string c_renewremark, string c_approveflowid,
                                                 string m_c_oid, string m_oid_user, string c_remark, string approveType)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>ApproveOvertime</OPTYPE><LIST><ROW>
                <c_oid_overtimeapply>" + c_oid_overtimeapply + @"</c_oid_overtimeapply>
                <applec_oid>" + applec_oid + @"</applec_oid>
                <c_renewremark>" + c_renewremark + @"</c_renewremark>
                <c_approveflowid>" + c_approveflowid + @"</c_approveflowid>
                <c_oid>" + m_c_oid + @"</c_oid>
                <m_oid_user>" + m_oid_user + @"</m_oid_user>
                <c_remark>" + c_remark + @"</c_remark>
                <overtimetype>" + approveType + @"</overtimetype>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///休假查询
        /// </summary>
        /// <param name="年"></param>
        /// <param name="月"></param>
        /// <returns></returns>
        public DataTable VacationGet(string c_oid, string year, string month)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>GetVacationSearch</OPTYPE><LIST><ROW>
                <c_oid>" + c_oid + @"</c_oid>
                <year>" + year + @"</year>
                <month>" + month + @"</month>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }


        /// <summary>
        ///验证该时段是否有休假
        /// </summary>
        /// <param name="c_oid"></param>
        /// <returns></returns>
        public DataTable CheckVacation(string c_oid, string c_begintime, string c_endtime)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>CheckVacation</OPTYPE><LIST><ROW>
                <c_oid>" + c_oid + @"</c_oid>
                <c_begintime>" + c_begintime + @"</c_begintime>
                <c_endtime>" + c_endtime + @"</c_endtime>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///休假申请提交
        /// </summary>
        /// <param name="c_oid"></param>
        /// <returns></returns>
        public DataTable VacationApplySubmit(string c_oid, string sp1, string c_attitemoid, string c_year, string begindate, string enddate, string c_value, string c_reason,
          string c_principal, string c_linkman, string c_remark)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>ApplyVacation</OPTYPE><LIST><ROW>
                <c_oid>" + c_oid + @"</c_oid>
                <sp1>" + sp1 + @"</sp1>
                <c_attitemoid>" + c_attitemoid + @"</c_attitemoid>
                <c_year>" + c_year + @"</c_year>
                <begindate>" + begindate + @"</begindate>
                <enddate>" + enddate + @"</enddate>
                <c_value>" + c_value + @"</c_value>
                <c_reason>" + c_reason + @"</c_reason>
                <c_principal>" + c_principal + @"</c_principal>
                <c_linkman>" + c_linkman + @"</c_linkman>
                <c_remark>" + c_remark + @"</c_remark>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///获取休假审批数据
        /// </summary>
        /// <param name="m_c_oid"></param>
        /// <returns></returns>
        public DataTable VacationGetApprove(string c_oid)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>GetApproveVacationInfo</OPTYPE><LIST><ROW>
                <c_oid>" + c_oid + @"</c_oid>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }
        /// <summary>
        ///审批休假数据
        /// </summary>
        /// <param name="m_c_oid"></param>
        /// <returns></returns>
        ///// 
        public DataTable VacationApproveSubmit(string c_oid, string c_remark, string m_oid_user, string c_approveflowid, string c_oid_vocationapply, string vacationtype)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>ApproveVacationInfo</OPTYPE><LIST><ROW>
                <c_oid>" + c_oid + @"</c_oid>
                <c_remark>" + c_remark + @"</c_remark>
                <m_oid_user>" + m_oid_user + @"</m_oid_user>
                <c_approveflowid>" + c_approveflowid + @"</c_approveflowid>
                <c_oid_vocationapply>" + c_oid_vocationapply + @"</c_oid_vocationapply>
                <vacationtype>" + vacationtype + @"</vacationtype>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///出差查询
        /// </summary>
        /// <param name="年"></param>
        /// <param name="月"></param>
        /// <returns></returns>
        public DataTable OutGet(string c_oid, string year, string month)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>GetBusinessOutSearch</OPTYPE><LIST><ROW>
                <c_oid>" + c_oid + @"</c_oid>
                <year>" + year + @"</year>
                <month>" + month + @"</month>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///验证该时段是否有出差
        /// </summary>
        /// <param name="c_oid"></param>
        /// <returns></returns>
        public DataTable CheckOut(string c_oid, string c_begintime, string c_endtime)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>CheckBusinessOut</OPTYPE><LIST><ROW>
                <c_oid>" + c_oid + @"</c_oid>
                <c_begintime>" + c_begintime + @"</c_begintime>
                <c_endtime>" + c_endtime + @"</c_endtime>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }
        /// <summary>
        ///出差申请提交
        /// </summary>
        /// <param name="c_oid"></param>
        /// <returns></returns>
        public DataTable OutApplySubmit(string c_oid, string sp1, string c_remark, string begindate, string enddate, string c_value, string c_attitemid,
          string c_vehicle, string c_reason, string c_destname, string c_destaddress, string c_destination, string c_contactperson, string c_contactphone)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>ApplyBusinessOut</OPTYPE><LIST><ROW>
                <c_oid>" + c_oid + @"</c_oid>
                <sp1>" + sp1 + @"</sp1>
                <c_remark>" + c_remark + @"</c_remark>
                <c_remark>" + c_remark + @"</c_remark>
                <begindate>" + begindate + @"</begindate>
                <enddate>" + enddate + @"</enddate>
                <c_value>" + c_value + @"</c_value>
                <c_attitemid>" + c_attitemid + @"</c_attitemid>
                <c_vehicle>" + c_vehicle + @"</c_vehicle>
                <c_reason>" + c_reason + @"</c_reason>
                <c_destname>" + c_destname + @"</c_destname>
                <c_destaddress>" + c_destaddress + @"</c_destaddress>
                <c_destination>" + c_destination + @"</c_destination>
                <c_contactperson>" + c_contactperson + @"</c_contactperson>
                <c_contactphone>" + c_contactphone + @"</c_contactphone>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        /// <summary>
        ///获取出差审批数据
        /// </summary>
        /// <param name="m_c_oid"></param>
        /// <returns></returns>
        public DataTable OutGetApprove(string c_oid)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>GetApproveBusinessOutInfo</OPTYPE><LIST><ROW>
                <c_oid>" + c_oid + @"</c_oid>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }
        /// <summary>
        ///审批出差数据
        /// </summary>
        /// <param name="m_c_oid"></param>
        /// <returns></returns>
        ///// 
        public DataTable OutApproveSubmit(string c_oid, string c_remark, string m_oid_user, string applec_oid, string c_approveflowid, string c_oid_outapply, string businessouttype)
        {
            DataSet ds = dal.ExcuteWsrr("cc517737-703e-4228-93cd-937d9bc328e6", @"<XML><ROOT><OPTYPE>ApproveBusinessOutInfo</OPTYPE><LIST><ROW>
                <c_oid>" + c_oid + @"</c_oid>
                <c_remark>" + c_remark + @"</c_remark>
                <m_oid_user>" + m_oid_user + @"</m_oid_user>
                <applec_oid>" + applec_oid + @"</applec_oid>
                <c_approveflowid>" + c_approveflowid + @"</c_approveflowid>
                <c_oid_outapply>" + c_oid_outapply + @"</c_oid_outapply>
                <businessouttype>" + businessouttype + @"</businessouttype>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }

        #endregion

        #region 卓莱雅券号创建券

        /// <summary>
        /// 卓莱雅券号创建券
        /// </summary>
        /// <param name="面币"></param>
        /// <param name="password"></param>
        /// <returns></returns>
        public DataTable JLTicketCreate(string sums)
        {
            DataSet ds = dal.ExcuteWsrr("cfd99a2f-22c6-44c4-95fb-c7d7cfa5b4cb", @"<XML><ROOT><OPTYPE>JLTicketCreate</OPTYPE><LIST><ROW>
                <sums>" + sums + @"</sums>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }


        #endregion

        #region 验证小翅膀登入

        /// <summary>
        /// 验证小翅膀登入
        /// </summary>
        /// <param name="姓名"></param>
        /// <param name="password"></param>
        /// <returns></returns>
        public DataTable CheackAMUser(string password, string name)
        {
            DataSet ds = dal.ExcuteWsrr("7d67a621-f3a4-498f-84cd-ae3447635ccbb", @"<XML><ROOT><OPTYPE>CheackAMUser</OPTYPE><LIST><ROW>
                <AM_login>" + name + @"</AM_login>
                <AM_Password>" + password + @"</AM_Password>
                </ROW></LIST></ROOT></XML>");
            DataTable dt = ds.Tables[1];
            return dt;
        }
        #endregion


    }
}